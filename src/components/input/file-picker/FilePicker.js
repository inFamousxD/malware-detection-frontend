import React, { useState } from 'react';
import {
    Card, Button
} from 'react-bootstrap';

const FilePicker = ({ inputs, setInputs }) => {
    let fileReader;

    const [stringsByUpload, setStringsByUpload] = useState([]);
    const [count, setCount] = useState(0)

    const handleFileRead = () => {
        setStringsByUpload(stringsByUpload.push(...fileReader.result.split(',\n')));
        setCount(count + stringsByUpload.length);

        handleFileInput();
    }


    const handleFileChosen = (file) => {
        fileReader = new FileReader();
        fileReader.onloadend = handleFileRead;
        fileReader.readAsText(file);
    }

    const handleFileInput = () => {
        let xinput = [];
        stringsByUpload.forEach(string => {
            xinput.push({ 
                string: string,
                mode: 'by FileRead',
                time: Date.now() 
            });
        })
        setInputs(inputs.concat(xinput));
    }

    const clearFileReader = () => {
        fileReader = null;
        setStringsByUpload([]);
        setCount(0);
    }

    return (
        <div>
            <Card style={{
                width: '90%',
                marginTop: '4vh',
                fontSize: '14px',
                height: '20vh',
                borderRadius: '0px',
                border: '2px solid #999',
            }}>
                <Card.Body style={{userSelect: 'none'}}>
                    { count } strings read from file. 
                </Card.Body>
                <Card.Footer>
                    <input type='file' accept='.csv' onChange={e => {handleFileChosen(e.target.files[0]);}} id='file' className='btn btn-dark' style={{
                        fontSize: '12px',
                    }} />
                    <Button onClick={clearFileReader} variant='dark' style={{
                        border: '1px solid #999',
                        borderRadius: '0px',
                        borderTopRightRadius: '5px',
                        borderBottomRightRadius: '5px'
                    }}>Confirm</Button>                    
                </Card.Footer>
            </Card>
        </div>
    )
}

export default FilePicker
