import React, { useState, useEffect } from 'react';
import { Card, Col, Row } from 'react-bootstrap';
import permissionList from '../../input/permission-card/permissionList';
import PermissionContent from './PermissionContent';

const Details = ({ data }) => {
    const [orig, setOrig] = useState("");
    const [advr, setAdvr] = useState("");
    const [changedIndexes, setChangedIndexes] = useState([]);
    const [current, setCurrent] = useState(0);

    useEffect(() => {
        setOrig(data[current].originalString);
        setAdvr(data[current].adversarialString);
        compare(data[current].originalString, data[current].adversarialString);
    }, [data[current].originalString, data[current].adversarialString]);

    const compare = (o, a) => {
        let idx = [];
        for (let i = 0; i < a.length; ++i) {
            if (o.charAt(i) !== a.charAt(i)) idx.push(i);
        }
        setChangedIndexes(idx);
    }

    const handleCurrent = (i) => {
        setCurrent(i);
    }

    const selector = {
        userSelect: 'none',
        cursor: 'pointer',
        padding: '2vh 0vw',
        borderBottom: '1px solid rgba(10, 10, 10, 0.2)'
    }

    return (
        <div style={{userSelect: 'none'}}>
            <Card style={{
                width: '95%',
                marginTop: '4vh',
                fontSize: '14px',
                height: '7vh',
                borderRadius: '0px',
                border: '2px solid rgba(0, 0, 0, 0.15)',
            }}>
                <Card.Body>
                    Outputs Recieved :  { data.length }
                </Card.Body>
            </Card>
            <Row style={{ width: '96.65%' }}>
                <Col sm={2} lg={2} md={2} xl={2}>
                    <Card style={{
                        width: '100%',
                        marginTop: '3.25vh',
                        fontSize: '14px',
                        height: '74vh',
                        borderRadius: '0px',
                        // border: '2px solid #999',
                        border: '0px',
                        overflowY: 'scroll'
                    }}>
                        <Card.Body>
                            <div style={{ paddingBottom: '2vh', borderBottom: '1px solid rgba(10, 10, 10, 0.2)' }}>Picker List</div>
                            {
                                data.map((x, i) => {
                                    return (
                                        <div style={selector} onClick={() => handleCurrent(i)} key={i}>
                                            { current === i ? <span style={{ color: '#0069cc' }}>index {i} (viewing)</span> : `index ${i}` }
                                        </div>
                                    );
                                })
                            }
                        </Card.Body>
                    </Card>
                </Col>
                <Col sm={10} lg={10} md={10} xl={10}>
                    <Card style={{
                        width: '100%',
                        marginTop: '3.25vh',
                        fontSize: '14px',
                        height: '74vh',
                        borderRadius: '0px',
                        // border: '2px solid #999',
                        border: '0px'
                    }}>
                        <Card.Body>
                            Output Detail | Index { current }
                            <hr style={{color: '#999', opacity: '1'}}/>
                            <span style={{ color: '#0069cc' }}>Original String </span> <br />
                            {
                                orig.split('').map((x, i) => {
                                    if (changedIndexes.includes(i)) return <span key={i} style={{ color: '#cc0009' }}>{x}</span>
                                    else return <span key={i}>{x}</span>
                                })
                            }
                            
                            <br /> <br />
                            <span style={{ color: '#0069cc' }}>Adversarial String </span> <br />
                            {
                                advr.split('').map((x, i) => {
                                    if (changedIndexes.includes(i)) return <span key={i} style={{ color: '#09cc00', fontWeight: 'bold' }}>{x}</span>
                                    else return <span key={i}>{x}</span>
                                })
                            }
                            <br /> <hr style={{color: '#999', opacity: '1'}}/>
                            Permissions modified : {changedIndexes.length}
                            <hr style={{color: '#999', opacity: '1'}}/>
                            <Row>
                                <Col sm={5} lg={5} xs={5} md={5}>
                                    <Card style={{
                                        width: '100%',
                                        marginTop: '2vh',
                                        fontSize: '14px',
                                        overflowY: 'scroll',
                                        borderRadius: '0px',
                                        border: '2px solid rgba(0, 0, 0, 0.15)',
                                        borderRight: '0px',
                                        height: '37.5vh'
                                    }}>
                                        <Card.Body>
                                            <Row style={{ marginBottom: '2vh' }}>
                                                <Col><b>Permissions Activated after Attack</b></Col>
                                            </Row>
                                            <hr style={{color: '#999', opacity: '1'}}/>
                                            {
                                                permissionList.length > 0 && permissionList.map((p, i) => {
                                                    if (changedIndexes.includes(i)) return <PermissionContent key={i} permission={p} index={i}/>
                                                    else return null
                                                })
                                            }
                                        </Card.Body>
                                    </Card>
                                </Col>
                                <Col sm={7} lg={7} xs={7} md={7}>
                                {/* <Card style={{
                                        width: '100%',
                                        marginTop: '2vh',
                                        fontSize: '14px',
                                        borderRadius: '0px',
                                        border: '2px solid rgba(0, 0, 0, 0.15)',
                                        height: '37.5vh'
                                    }}>
                                        <Card.Body>Graph (?)</Card.Body>
                                    </Card>             */}
                                </Col>
                            </Row>
                            
                        </Card.Body>
                    </Card>
                </Col>
            </Row>
            
        </div>
    )
}

export default Details
